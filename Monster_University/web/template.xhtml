<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:pe="http://primefaces.org/ui/extensions"
    xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <title><ui:insert name="title">Default Title</ui:insert></title>
    <h:outputStylesheet library="css" name="jsfcrud.css"/>
    <h:outputScript library="js" name="jsfcrud.js"/>

   <style>
    .layout-container {
        display: grid;
        grid-template-rows: 65px auto 60px;
        min-height: 100vh;
        width: 100%;
    }

    .layout-north {
        grid-row: 1;
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
        padding: 0.5rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        z-index: 10;
    }

    .layout-center {
        grid-row: 2;
        padding: 1rem;
        overflow: auto;
        background-image: 
            linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)),
            url('https://www.bangor.ac.uk/sites/default/files/styles/16x9_1100w/public/2020-05/CB%202018%20May%20%2837%29.jpg?h=41ef3158&amp;itok=zGs3cG5Q');
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        background-repeat: no-repeat;
        position: relative;
    }

    .layout-south {
        grid-row: 3;
        background-color: rgba(233, 236, 239, 0.9);
        border-top: 1px solid #dee2e6;
        padding: 0.5rem;
        display: flex;
        align-items: center;
        z-index: 10;
    }

    .app-header {
        font-size: 1.6rem;
        font-weight: bold;
        color: #2a64c5;
    }

    .menu-btn, .user-btn {
        font-weight: bold;
        margin-left: 10px;
    }

    .user-menu {
        display: flex;
        justify-content: flex-end;
        width: 100%;
    }
</style>
</h:head>

<h:body>

    <p:growl id="growl" life="3000"/>

    <!-- Global delete confirmation dialog -->
    <h:form id="globalConfirmForm">
        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" severity="warn">
            <p:commandButton value="Sí, eliminar" type="button" styleClass="ui-confirmdialog-yes p-button-danger" icon="pi pi-trash"/>
            <p:commandButton value="Cancelar" type="button" styleClass="ui-confirmdialog-no p-button-secondary" icon="pi pi-times"/>
        </p:confirmDialog>
        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade" severity="info">
            <p:commandButton value="Sí, guardar" type="button" styleClass="ui-confirmdialog-yes p-button-primary" icon="pi pi-check"/>
            <p:commandButton value="Cancelar" type="button" styleClass="ui-confirmdialog-no p-button-secondary" icon="pi pi-times"/>
        </p:confirmDialog>
    </h:form>

    <div class="layout-container">

        <!-- ==================================== HEADER ====================================== -->
        <div class="layout-north">

            <!-- TÍTULO -->
            <div class="app-header">MONSTER UNIVERSITY</div>

            <!-- MENÚS DINÁMICOS SEGÚN ROL -->
            <div class="user-menu">
                <h:form id="menuForm">
                    <!-- HOME - Siempre visible si está logueado -->
                    <p:button value="Home"
                              icon="pi pi-home"
                              outcome="/faces/index1.xhtml"
                              rendered="#{loginController.loggedIn}"
                              styleClass="menu-btn"/>
                    
                    <!-- PERSONAL - Solo si tiene alguna opción de Personal -->
                    <p:menuButton value="Personal" 
                                  styleClass="menu-btn"
                                  rendered="#{loginController.loggedIn and loginController.tieneOpcionEnGrupo('PER', 'CRE')}">
                        
                        <!-- Crear Personal - Solo si tiene la opción CRE -->
                        <p:menuitem value="Crear Personal"
                                    icon="pi pi-user"
                                    outcome="/faces/crearpersonal.xhtml"
                                    rendered="#{loginController.tieneOpcion('CRE')}"/>
                        
                        <!-- Si no tiene opciones específicas, mostrar mensaje -->
                        <p:menuitem value="No tiene permisos"
                                    icon="pi pi-lock"
                                    disabled="true"
                                    rendered="#{not loginController.tieneOpcionEnGrupo('CRE')}"/>
                    </p:menuButton>

                    <!-- FINANZAS - Solo si tiene alguna opción de Finanzas -->
                    <p:menuButton value="Finanzas" 
                                  styleClass="menu-btn"
                                  rendered="#{loginController.loggedIn and loginController.tieneOpcion('FIN')}">
                        <!-- Aquí irían las subopciones de Finanzas si las tuvieras -->
                        <p:menuitem value="Funcionalidades de Finanzas"
                                    icon="pi pi-money-bill"
                                    outcome="#"
                                    disabled="true"/>
                    </p:menuButton>

                    <!-- ACADÉMICO - Solo si tiene alguna opción de Académico -->
                    <p:menuButton value="Académico" 
                                  styleClass="menu-btn"
                                  rendered="#{loginController.loggedIn and loginController.tieneOpcionEnGrupo('ACA', 'AC1', 'AC2')}">
                        
                        <!-- Administrar Carreras - Solo si tiene la opción AC1 -->
                        <p:menuitem value="Administrar Carreras"
                                    icon="pi pi-briefcase"
                                    outcome="/mecarrCarrera/List.xhtml"
                                    rendered="#{loginController.tieneOpcion('AC1')}"/>
                        
                        <!-- Reporte de Carreras - Solo si tiene la opción AC2 -->
                        <p:menuitem value="Reporte de Carreras"
                                    icon="pi pi-file"
                                    outcome="/faces/reporte_carreras.xhtml"
                                    rendered="#{loginController.tieneOpcion('AC2')}"/>
                        
                        <!-- Si no tiene opciones específicas -->
                        <p:menuitem value="No tiene permisos académicos"
                                    icon="pi pi-lock"
                                    disabled="true"
                                    rendered="#{not loginController.tieneOpcionEnGrupo('AC1', 'AC2')}"/>
                    </p:menuButton>

                    <!-- SEGURIDAD - Solo si tiene alguna opción de Seguridad -->
                    <p:menuButton value="Seguridad" 
                                  styleClass="menu-btn"
                                  rendered="#{loginController.loggedIn and loginController.tieneOpcionEnGrupo('SEG', 'SE1', 'SE2')}">
                        
                        <!-- Administrar Roles - Solo si tiene la opción SE1 -->
                        <p:menuitem value="Administrar Roles"
                                    icon="pi pi-users"
                                    outcome="/xerolRol/List.xhtml"
                                    rendered="#{loginController.tieneOpcion('SE1')}"/>
                        
                        <!-- Asignar Roles - Solo si tiene la opción SE2 -->
                        <p:menuitem value="Asignar Roles"
                                    icon="pi pi-shield"
                                    outcome="/faces/asignacion_roles.xhtml"
                                    rendered="#{loginController.tieneOpcion('SE2')}"/>
                        
                        <!-- Asignar Opciones a Roles - Solo si tiene la opción SE2 -->
                        <p:menuitem value="Asignar Opciones"
                                    icon="pi pi-cog"
                                    outcome="/faces/asignar_opciones.xhtml"
                                    rendered="#{loginController.tieneOpcion('SE2')}"/>
                        
                        <!-- Si no tiene opciones específicas -->
                        <p:menuitem value="No tiene permisos de seguridad"
                                    icon="pi pi-lock"
                                    disabled="true"
                                    rendered="#{not loginController.tieneOpcionEnGrupo('SE1', 'SE2')}"/>
                    </p:menuButton>
                     

                    <!-- USUARIO LOGUEADO -->
                    <p:menuButton value="#{loginController.usuarioLogueado.xeusuNombre}"
                                  icon="pi pi-user"
                                  styleClass="menu-btn"
                                  rendered="#{loginController.loggedIn}">

                        <!-- Opciones personales del usuario -->
                        
                                    
                        <p:menuitem value="Cambiar contraseña"
                                    icon="pi pi-key"
                                    outcome="/cambioContrasena.xhtml"/>

                        <p:separator/>
                        
                        <!-- Solo administradores pueden ver esta opción -->
                       

                        <p:menuitem value="Cerrar sesión"
                                    icon="pi pi-sign-out"
                                    action="#{loginController.doLogout}"
                                    ajax="false"/>
                    </p:menuButton>

                    <!-- LOGIN SI NO ESTÁ LOGUEADO -->
                    <p:button value="Iniciar Sesión"
                              icon="pi pi-sign-in"
                              outcome="/login.xhtml"
                              rendered="#{not loginController.loggedIn}" />
                </h:form>
            </div>
        </div>

        <!-- ==================================== CONTENIDO CENTRAL ====================================== -->
        <div class="layout-center">
            <ui:insert name="body"/>
        </div>

        <!-- ==================================== FOOTER ====================================== -->
        <div class="layout-south">
            <ui:insert name="footer"/>
            <div style="margin-left: auto;">
                <h:outputText value="Usuario: #{loginController.usuarioLogueado.xeusuNombre}" 
                             rendered="#{loginController.loggedIn}"/>
                <h:outputText value=" | Rol: #{loginController.usuarioLogueado.xerolId.xerolNombre}" 
                             rendered="#{loginController.loggedIn and loginController.usuarioLogueado.xerolId != null}"/>
            </div>
        </div>

    </div>

</h:body>
</html>