<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:p="http://primefaces.org/ui"
                template="/template.xhtml">

    <ui:define name="title">
        <h:outputText value="Lista de Roles"/>
    </ui:define>

    <ui:define name="body">
        <p:growl id="messages" showDetail="true"/>
        
        <h:form id="rolForm">
            <p:panel header="Roles del Sistema">
                
                <!-- Botón Nuevo -->
                <p:toolbar style="margin-bottom: 10px;">
                    <p:toolbarGroup>
                        <p:commandButton value="Nuevo Rol" 
                                       icon="pi pi-plus" 
                                       action="#{rolController.nuevoRol}" 
                                       update=":rolCreateForm"
                                       oncomplete="PF('rolCreateDialog').show()"/>
                    </p:toolbarGroup>
                </p:toolbar>
                
                <!-- Tabla de roles -->
                <p:dataTable id="tablaRoles" 
                           value="#{rolController.roles}" 
                           var="rol"
                           paginator="true" 
                           rows="10"
                           emptyMessage="No se encontraron roles"
                           style="margin-top: 20px;">
                    
                    <!-- Columnas -->
                    <p:column headerText="Código" sortBy="#{rol.codigo}" style="width: 120px;">
                        <h:outputText value="#{rol.codigo}"/>
                    </p:column>
                    
                    <p:column headerText="Nombre" sortBy="#{rol.nombre}">
                        <h:outputText value="#{rol.nombre}"/>
                    </p:column>
                    
                    <p:column headerText="Estado" style="width: 100px;">
                        <p:tag value="#{rol.estado}" 
                               severity="#{rol.estado eq 'ACTIVO' ? 'success' : 'danger'}"/>
                    </p:column>
                    
                    <p:column headerText="Acciones" style="width: 200px; text-align: center;">
                        <!-- Botón Ver -->
                        <p:commandButton icon="pi pi-eye" 
                                       title="Ver"
                                       action="#{rolController.seleccionarRol(rol.codigo)}"
                                       update=":rolViewForm"
                                       oncomplete="PF('rolViewDialog').show()">
                            <f:setPropertyActionListener target="#{rolController.codigoRolSeleccionado}" 
                                                       value="#{rol.codigo}" />
                        </p:commandButton>
                        
                        <!-- Botón Editar -->
                        <p:commandButton icon="pi pi-pencil" 
                                       title="Editar"
                                       action="#{rolController.seleccionarRol(rol.codigo)}"
                                       update=":rolEditForm"
                                       oncomplete="PF('rolEditDialog').show()"
                                       style="margin-left: 5px;">
                            <f:setPropertyActionListener target="#{rolController.codigoRolSeleccionado}" 
                                                       value="#{rol.codigo}" />
                        </p:commandButton>
                        
                        <!-- Botón Eliminar -->
                        <p:commandButton icon="pi pi-trash" 
                                       title="Eliminar"
                                       action="#{rolController.eliminarRolPorCodigo(rol.codigo)}"
                                       update=":messages :rolForm:tablaRoles"
                                       style="margin-left: 5px;">
                            <p:confirm header="Confirmar" 
                                     message="¿Eliminar rol #{rol.nombre}?"/>
                        </p:commandButton>
                    </p:column>
                    
                </p:dataTable>
            </p:panel>
        </h:form>
        
        <!-- Diálogos -->
        <ui:include src="rol/Create.xhtml"/>
        <ui:include src="rol/Edit.xhtml"/>
        <ui:include src="rol/View.xhtml"/>
        
    </ui:define>
</ui:composition>